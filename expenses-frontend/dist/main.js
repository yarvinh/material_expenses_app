(()=>{"use strict";class e{constructor(e){this.data=e}get renderUser(){const e=document.createElement("h3");e.textContent=`Welcome ${this.data.name}`,header.appendChild(e),header.className="header"}get renderLocationAfterCreate(){e.location(this.data)}get locationRender(){this.data.locations.forEach((t=>{e.location(t)}))}static location(t){let n=document.createElement("div"),i=document.createElement("div"),a=document.createElement("label"),o=document.createElement("input"),c=document.createElement("label"),l=document.createElement("button"),d=document.createElement("br"),s=document.createElement("br");i.className="hide_location",n.className="location",n.id=`location_${t.id}`,a.textContent="Add Receipt:",c.textContent="Delete this location:",l.textContent="Remove",l.className="delete",o.id=t.id,o.className="receipt_input",locations.appendChild(n);const r=document.createElement("button");r.textContent=t.address,r.className="location_accordion",n.appendChild(r),n.appendChild(i),e.editInput(i),i.appendChild(c),i.appendChild(l),i.appendChild(d),i.appendChild(s),i.appendChild(a),i.appendChild(o)}get receiptRender(){let t=this.data.locations,n=this.data.receipts;t.forEach((function(t){n.forEach((function(n){t.id===n.location_id&&e.renderProjectAfterCreated(n)}))}))}static renderProjectAfterCreated(e){let t=document.getElementById(`location_${e.location_id}`),n=document.createElement("div"),i=document.createElement("p"),a=document.createElement("form");n.id=`receipt_${e.id}`,n.className="receipt",i.innerHTML=`${e.project_name} <button>Delete</button`,i.children[0].className="delete",n.appendChild(i),a.id=`form_${e.id}`,t.children[1].appendChild(n);let o=document.createElement("button");o.textContent="Add Item",o.id=`button_${e.id}`,o.className="receipt_button",n.appendChild(o),n.appendChild(a)}static itemInputs(e){let t=e.children[2];if(t.children.length<=4){let e=document.createElement("label");e.textContent="Item Name:",e.className="item_input";let n=document.createElement("input");n.className="item_input",t.appendChild(e),t.appendChild(n);let i=document.createElement("label");i.textContent="Price:",i.className="item_input";let a=document.createElement("input");a.className="item_input",t.appendChild(i),t.appendChild(a);let o=document.createElement("button");o.textContent="Submit",o.className="item_button",t.appendChild(o)}}static renderItemList(e){let t=document.getElementById(`receipt_${e}`),n=document.createElement("ol");n.id=`list_${e}`,t.appendChild(n)}static renderItemAfterCreated(t){e.items(t.receipt,t);const n=document.getElementById(`totalp_${t.receipt_id}`),i=document.getElementById(`receipt_${t.receipt_id}`);let a=parseInt(t.price);if(n){let e=parseInt(n.textContent.split(" ")[2]);n.textContent=`Total = ${e+a}`}else{const e=document.createElement("p");e.id=`totalp_${t.receipt_id}`,e.textContent=`Total = ${a}`,i.appendChild(e)}}static items(e,t){let n=document.getElementById(`list_${e.id}`),i=document.createElement("li");i.id=`item_${t.id}`,i.innerHTML=`${t.item_name} = ${t.price}  <button>X</button>`,i.children[0].className="delete",n.appendChild(i)}get itemsRender(){let t=this.data.receipts,n=this.data.items;t.forEach((function(t){let i=document.getElementById(`receipt_${t.id}`),a=document.createElement("p");a.id=`totalp_${t.id}`,e.renderItemList(t.id);let o=0;n.forEach((function(n){t.id===n.receipt_id&&(o+=parseInt(n.price),e.items(t,n))})),a.textContent=`Total = ${o}`,i.appendChild(a)}))}static substract(e){const t=e.parentNode;let n=e.parentNode.innerHTML.split(" ");n=n[n.length-4];let i=t.parentNode.nextSibling,a=parseInt(t.parentNode.nextSibling.textContent.split(" ")[2]);i.textContent=a?"total = "+(a-n):"total = 0"}static hideElements(e){e.nextSibling.className="display_location",e.classList.toggle("active")}static showElements(e,t){e.nextSibling.className="hide_location",e.className=t}static editInput(e){let t=e.parentNode.id.split("_");t=t[t.length-1];let n=document.createElement("button"),i=document.createElement("label");i.textContent="Edit location:",n.className="edit",n.textContent="Edit";const a=document.createElement("form");a.id=`edit_form_${t}`;const o=document.createElement("input");o.className="hide_location",e.appendChild(a),a.appendChild(i),a.appendChild(n),a.appendChild(o)}static renderEditLocation(e){document.getElementById(`location_${e.id}`).children[0].textContent=e.address}}const t="http://localhost:3000",n=document.getElementById("location_form");class i{constructor(e){this.baseUrl=e}get userFetch(){return fetch(`${this.baseUrl}/users/1`).then((e=>e.json())).then((t=>{const i=new e(t);i.renderUser,n.children[1].id=t.id,i.locationRender,i.receiptRender,i.itemsRender})).catch((e=>{console.log(e)}))}set createLocation(t){const n={address:t.target.children[1].value,user_id:t.target.children[1].id};fetch(`${this.baseUrl}/locations`,{method:"post",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(t){t.id&&new e(t).renderLocationAfterCreate})).catch((e=>{console.log(e)})),t.target.children[1].value=""}set createProject(t){if("Enter"===t.code){const n={project_name:t.target.value,location_id:t.target.id};fetch(`${this.baseUrl}/receipts`,{method:"post",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(t){console.log(t.id),t.id&&e.renderProjectAfterCreated(t)})).catch((e=>{console.log(e)})),t.target.value=""}}set createItem(t){const n={item_name:t.children[1].value,price:t.children[3].value,receipt_id:t.id.split("_")[1]};fetch(`${this.baseUrl}/items`,{method:"post",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(t){t.id&&(e.renderItemList(t.receipt_id),e.renderItemAfterCreated(t))})).catch((e=>{console.log(e)})),t.children[1].value="",t.children[3].value="",t.id.split("_")[1]=""}set deleteLocation(e){let n=e.id.split("_")[1];fetch(`${t}/locations/${n}`,{method:"DELETE"}),e.remove()}set deleteItem(e){let n=e.parentElement,i=n.id.split("_")[1];fetch(`${t}/items/${i}`,{method:"DELETE"}),n.remove()}set deleteReceipt(e){let n=e.id.split("_")[1];fetch(`${t}/receipts/${n}`,{method:"DELETE"}),e.remove()}set editLocation(t){let n=t.id.split("_");n=n[n.length-1],console.log(n);const i={address:t.children[2].value};fetch(`${this.baseUrl}/locations/${n}`,{method:"PATCH",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}).then((function(e){return e.json()})).then((function(n){e.renderEditLocation(n),t.children[2].value=""})).catch((e=>{console.log(e)}))}}class a{static locationInputEvent(e,t){e.addEventListener("submit",(e=>{e.preventDefault(),t.createLocation=e}))}static locationsEvent(e,t){e.addEventListener("click",(e=>{a.events(e,t)}))}static events(t,n){t.preventDefault();const i=t.target;if("receipt_input"===t.target.className)i.addEventListener("keyup",(e=>{n.createProject=e}));else if("receipt_button"===t.target.className)e.itemInputs(t.path[1]);else if("Remove"===t.target.textContent)n.deleteLocation=t.path[2];else if("X"===t.target.textContent)e.substract(t.target),n.deleteItem=t.target;else if("item_button"===t.target.className){let e=t.target.parentNode;n.createItem=e}else if("Delete"===t.target.textContent){const e=t.target.parentNode.parentNode;n.deleteReceipt=e}else"location_accordion"===i.className?e.hideElements(i):"location_accordion active"===i.className?e.showElements(i,"location_accordion"):"edit"===i.className?(e.hideElements(i),i.textContent="Save"):"edit active"===i.className&&(e.showElements(i,"edit"),i.textContent="Edit",n.editLocation=i.parentNode)}}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("locations"),t=document.getElementById("location_form");let n=new i("http://localhost:3000");a.locationInputEvent(t,n),a.locationsEvent(e,n),n.userFetch}))})();