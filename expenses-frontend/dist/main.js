(()=>{"use strict";class e{itemFormEventListener(e){e.addEventListener("submit",(e=>{e.preventDefault(),console.log(e.target.id.split("_")[1]);const t={item_name:e.target.children[1].value,price:e.target.children[3].value,receipt_id:e.target.id.split("_")[1]};new a("items").createItem=t,e.target.children[1].value="",e.target.children[3].value="",e.target.id.split("_")[1]=""}))}static deleteEventListener(t,n){t.addEventListener("click",(t=>{new a("items").deleteFetch=n.id.split("_")[1],e.substract(n),console.log(n),n.remove()}))}set itemInputs(e){let t=e.children[2];if(t.children.length<=4){let e=document.createElement("label");e.textContent="Item Name:",e.className="item_input";let n=document.createElement("input");n.className="item_input",t.appendChild(e),t.appendChild(n);let i=document.createElement("label");i.textContent="Price:",i.className="item_input";let c=document.createElement("input");c.className="item_input",t.appendChild(i),t.appendChild(c);let a=document.createElement("button");a.textContent="Submit",a.className="item_button",t.appendChild(a),this.itemFormEventListener(t)}}static items(t,n){let i=document.getElementById(`list_${t.id}`),c=document.createElement("li");c.id=`item_${n.id}`,c.innerHTML=`${n.item_name} = ${n.price}  <button>X</button>`,c.children[0].className="delete",i.appendChild(c),e.deleteEventListener(c.children[0],c)}static renderItemList(e){let t=document.getElementById(`receipt_${e}`),n=document.createElement("ol");n.id=`list_${e}`,t.appendChild(n)}set itemsRender(t){let n=t.receipts,i=t.items;n.forEach((function(t){let n=document.getElementById(`receipt_${t.id}`),c=document.createElement("p");c.id=`totalp_${t.id}`,e.renderItemList(t.id);let a=0;i.forEach((function(n){t.id===n.receipt_id&&(a+=parseInt(n.price),e.items(t,n))})),c.textContent=`Total = ${a}`,n.appendChild(c)}))}static renderItemAfterCreated(t){e.items(t.receipt,t);const n=document.getElementById(`totalp_${t.receipt_id}`),i=document.getElementById(`receipt_${t.receipt_id}`);let c=parseInt(t.price);if(n){let e=parseInt(n.textContent.split(" ")[2]);n.textContent=`Total = ${e+c}`}else{const e=document.createElement("p");e.id=`totalp_${t.receipt_id}`,e.textContent=`Total = ${c}`,i.appendChild(e)}}static substract(e){const t=e;let n=e.parentNode.innerHTML.split(" ");n=n[n.length-4];let i=t.parentNode.nextSibling,c=parseInt(t.parentNode.nextSibling.textContent.split(" ")[2]);i.textContent=c?"total = "+(c-n):"total = 0"}}class t{constructor(e){this.data=e}static deleteReceiptEventListener=(e,t)=>{e.addEventListener("click",(e=>{e.preventDefault(),new a("receipts").deleteFetch=t.id.split("_")[1],t.remove()}))};static itemsInputEventListener(t,n,i){t.addEventListener("click",(t=>{new e(i).itemInputs=n}))}renderProjectAfterCreated(){receipt(this.data)}set receiptRender(e){let n=e.locations,i=e.receipts;n.forEach((function(e){i.forEach((function(n){e.id===n.location_id&&t.receipt(n)}))}))}set addReceipt(e){new a("receipts").createProject=e,e.value=""}static receipt(e){let n=document.getElementById(`location_${e.location_id}`),i=document.createElement("div"),c=document.createElement("p"),a=document.createElement("form");i.id=`receipt_${e.id}`,i.className="receipt",c.innerHTML=`${e.project_name} <button>Delete</button`,c.children[0].className="delete",i.appendChild(c),a.id=`form_${e.id}`,n.children[1].appendChild(i);let o=document.createElement("button");o.textContent="Add Item",o.id=`button_${e.id}`,o.className="receipt_button",i.appendChild(o),i.appendChild(a),t.itemsInputEventListener(o,i,e),t.deleteReceiptEventListener(c.children[0],i)}set renderProjectAfterCreated(e){t.receipt(e)}}class n{constructor(e){this.data=e}toggleLocationAcordion=e=>{"location_accordion"===e.className?n.hideElements(e):"location_accordion active"===e.className&&n.showElements(e,"location_accordion")};locationEventListener=e=>{e.addEventListener("click",(t=>this.toggleLocationAcordion(e)))};editEventListener=e=>{e.addEventListener("click",(t=>{t.preventDefault(),this.toggleEditAcordion(e)}))};toggleEditAcordion=e=>{"edit"===e.className?(n.hideElements(e),e.textContent="Save"):"edit active"===e.className&&(n.showElements(e,"edit"),e.textContent="Edit",new a("locations").editLocation=e.parentNode)};addReceiptEventListener=e=>{e.addEventListener("keyup",(n=>{n.preventDefault(),"Enter"===n.code&&(new t(this.data).addReceipt=e)}))};deleteEventListener=(e,t)=>{e.addEventListener("click",(e=>{new a("locations").deleteFetch=t.id.split("_")[1],t.remove()}))};static locationInputEvent(e,t){e.addEventListener("submit",(e=>{e.preventDefault(),t.createLocation=e}))}get renderUser(){const e=document.createElement("h3");e.textContent=`Welcome ${this.data.name}`,header.appendChild(e),header.className="header"}get locationRender(){this.data.locations.forEach((e=>{this.location(e)}))}get renderLocationAfterCreate(){this.location(this.data)}location(e){let t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("label"),c=document.createElement("input"),a=document.createElement("label"),o=document.createElement("button"),d=document.createElement("br"),l=document.createElement("br");n.className="hide_location",t.className="location",t.id=`location_${e.id}`,i.textContent="Add Receipt:",a.textContent="Delete this location:",o.textContent="Remove",o.className="delete",c.id=e.id,c.className="receipt_input",locations.appendChild(t);const r=document.createElement("button");r.textContent=e.address,r.className="location_accordion",t.appendChild(r),t.appendChild(n),this.editInput(n),n.appendChild(a),n.appendChild(o),n.appendChild(d),n.appendChild(l),n.appendChild(i),n.appendChild(c),this.locationEventListener(r),this.addReceiptEventListener(c),this.deleteEventListener(o,t)}static renderEditLocation(e){document.getElementById(`location_${e.id}`).children[0].textContent=e.address}editInput(e){let t=e.parentNode.id.split("_");t=t[t.length-1];let n=document.createElement("button"),i=document.createElement("label");i.textContent="Edit location:",n.className="edit",n.textContent="Edit";const c=document.createElement("form");c.id=`edit_form_${t}`;const a=document.createElement("input");a.className="hide_location",e.appendChild(c),c.appendChild(i),c.appendChild(n),c.appendChild(a),this.editEventListener(n)}static hideElements(e){e.nextSibling.className="display_location",e.classList.toggle("active")}static showElements(e,t){e.nextSibling.className="hide_location",e.className=t}}const i="http://localhost:3000",c=document.getElementById("location_form");class a{constructor(e){this.path=e}get userFetch(){return fetch(`${i}/${this.path}`).then((e=>e.json())).then((i=>{const a=new n(i),o=new e(i);a.renderUser,c.children[1].id=i.id,a.locationRender,new t(i).receiptRender=i,o.itemsRender=i})).catch((e=>{console.log(e)}))}set createLocation(e){const t={address:e.target.children[1].value,user_id:e.target.children[1].id};fetch(`${i}/locations`,{method:"post",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){e.id&&new n(e).renderLocationAfterCreate})).catch((e=>{console.log(e)})),e.target.children[1].value=""}set createProject(e){const n={project_name:e.value,location_id:e.id};fetch(`${i}/${this.path}`,{method:"post",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(e){e.id&&(new t(e).renderProjectAfterCreated=e)})).catch((e=>{console.log(e)}))}set createItem(t){fetch(`${i}/${this.path}`,{method:"post",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(t){t.id&&(e.renderItemList(t.receipt_id),e.renderItemAfterCreated(t))})).catch((e=>{console.log(e)}))}set deleteFetch(e){fetch(`${i}/${this.path}/${e}`,{method:"DELETE"})}set editLocation(e){let t=e.id.split("_");t=t[t.length-1];const c={address:e.children[2].value};fetch(`${i}/${this.path}/${t}`,{method:"PATCH",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(c)}).then((function(e){return e.json()})).then((function(t){n.renderEditLocation(t),e.children[2].value=""})).catch((e=>{console.log(e)}))}}const o=document.getElementById("location_form");document.addEventListener("DOMContentLoaded",(()=>{(class{static render(){let e=new a("users/1");n.locationInputEvent(o,e),e.userFetch}}).render()}))})();